# 项目结构说明

## 目录结构

```
MQA/
├── backend/                          # 后端服务
│   ├── app/
│   │   ├── __init__.py
│   │   ├── main.py                  # FastAPI应用入口
│   │   ├── config.py                # 配置文件
│   │   ├── api/                     # API路由
│   │   │   ├── __init__.py
│   │   │   ├── query.py            # 查询接口
│   │   │   ├── sql.py              # SQL接口
│   │   │   ├── history.py          # 历史接口
│   │   │   └── metadata.py         # 元数据接口
│   │   ├── core/                    # 核心业务逻辑
│   │   │   ├── __init__.py
│   │   │   ├── nl2sql/             # NL2SQL引擎
│   │   │   │   ├── __init__.py
│   │   │   │   ├── intent_classifier.py
│   │   │   │   ├── entity_extractor.py
│   │   │   │   ├── sql_generator.py
│   │   │   │   ├── rule_based_engine.py
│   │   │   │   ├── llm_based_engine.py
│   │   │   │   └── sql_validator.py
│   │   │   ├── query_executor/     # 查询执行器
│   │   │   │   ├── __init__.py
│   │   │   │   ├── db_manager.py
│   │   │   │   ├── query_executor.py
│   │   │   │   └── connection_pool.py
│   │   │   ├── result_processor/   # 结果处理
│   │   │   │   ├── __init__.py
│   │   │   │   ├── formatter.py
│   │   │   │   ├── chart_generator.py
│   │   │   │   └── exporter.py
│   │   │   └── metadata/           # 元数据管理
│   │   │       ├── __init__.py
│   │   │       ├── schema_manager.py
│   │   │       └── entity_mapping.py
│   │   ├── models/                  # 数据模型
│   │   │   ├── __init__.py
│   │   │   ├── query.py
│   │   │   └── response.py
│   │   ├── utils/                   # 工具函数
│   │   │   ├── __init__.py
│   │   │   ├── date_utils.py
│   │   │   ├── text_utils.py
│   │   │   └── logger.py
│   │   └── database/                # 数据库相关
│   │       ├── __init__.py
│   │       └── models.py
│   ├── tests/                       # 测试文件
│   │   ├── __init__.py
│   │   ├── test_nl2sql.py
│   │   ├── test_query_executor.py
│   │   └── test_api.py
│   ├── requirements.txt             # Python依赖
│   ├── Dockerfile                   # Docker镜像
│   └── .env.example                 # 环境变量示例
│
├── frontend/                         # 前端应用
│   ├── src/
│   │   ├── views/                   # 页面组件
│   │   ├── components/              # 通用组件
│   │   ├── api/                     # API调用
│   │   ├── utils/                   # 工具函数
│   │   ├── App.vue
│   │   └── main.js
│   ├── public/
│   ├── package.json
│   ├── vite.config.js
│   └── Dockerfile
│
├── docs/                             # 文档
│   ├── 系统详细设计文档.md
│   ├── API文档.md
│   └── 部署文档.md
│
├── docker-compose.yml               # Docker编排
├── .gitignore
└── README.md                         # 项目说明
```

## 模块说明

### 后端模块

#### 1. API层 (app/api/)
- **query.py**: 自然语言查询接口
- **sql.py**: SQL直接查询接口
- **history.py**: 查询历史接口
- **metadata.py**: 元数据查询接口

#### 2. 核心业务层 (app/core/)

##### NL2SQL引擎 (nl2sql/)
- **intent_classifier.py**: 意图分类，识别用户查询意图
- **entity_extractor.py**: 实体抽取，提取线路、车站、时间等实体
- **sql_generator.py**: SQL生成，根据意图和实体生成SQL
- **rule_based_engine.py**: 基于规则的NL2SQL引擎
- **llm_based_engine.py**: 基于大语言模型的NL2SQL引擎
- **sql_validator.py**: SQL验证，检查SQL安全性和正确性

##### 查询执行器 (query_executor/)
- **db_manager.py**: 数据库连接管理
- **query_executor.py**: 查询执行逻辑
- **connection_pool.py**: 连接池管理

##### 结果处理 (result_processor/)
- **formatter.py**: 数据格式化
- **chart_generator.py**: 图表配置生成
- **exporter.py**: 数据导出功能

##### 元数据管理 (metadata/)
- **schema_manager.py**: 数据库表结构管理
- **entity_mapping.py**: 实体映射（车站名、线路名等）

#### 3. 数据模型 (app/models/)
- **query.py**: 查询请求和响应模型
- **response.py**: 统一响应格式

#### 4. 工具函数 (app/utils/)
- **date_utils.py**: 日期处理工具
- **text_utils.py**: 文本处理工具
- **logger.py**: 日志配置

### 前端模块

#### 1. 页面组件 (views/)
- **QueryPage.vue**: 主查询页面
- **HistoryPage.vue**: 查询历史页面
- **DashboardPage.vue**: 数据看板页面

#### 2. 通用组件 (components/)
- **QueryInput.vue**: 查询输入框
- **ResultTable.vue**: 结果表格
- **ResultChart.vue**: 结果图表
- **QueryHistory.vue**: 查询历史组件

#### 3. API调用 (api/)
- **query.js**: 查询相关API
- **history.js**: 历史相关API

## 配置文件

### 后端配置 (app/config.py)
- 数据库连接配置
- Redis配置
- LLM API配置
- 日志配置

### 前端配置
- API基础URL配置
- 图表主题配置

## 数据流

1. **用户输入** → 前端QueryInput组件
2. **API请求** → POST /api/v1/query
3. **NL2SQL处理** → 意图识别 → 实体抽取 → SQL生成
4. **SQL验证** → 安全检查 → 语法检查
5. **查询执行** → 数据库查询 → 结果返回
6. **结果处理** → 数据格式化 → 图表生成
7. **响应返回** → JSON格式 → 前端展示

## 扩展点

1. **NL2SQL引擎**: 可以替换为不同的实现（规则、LLM、混合）
2. **数据源**: 可以扩展支持更多数据库
3. **图表类型**: 可以添加更多图表类型
4. **导出格式**: 可以支持更多导出格式

