# 客流增长率分析系统 - 使用指南

## 🎯 系统功能

一键分析指定时段（如五一假期）相比上月的客流增长趋势。

## 📋 使用步骤

### 1. 选择指标类型
在下拉菜单中选择要分析的指标：
- **客流量**：总客流量
- **进站人数**：进站乘客数
- **出站人数**：出站乘客数
- **换乘人数**：换乘乘客数
- **乘降量**：上下车总量

### 2. 选择分析日期范围
选择你要分析的日期范围，例如：
- **2025年5月1日 - 5月5日**（五一假期）
- **2025年10月1日 - 10月7日**（国庆假期）
- 或任意你关心的日期范围

**提示**：
- 选择开始日期后，结束日期会自动设置为5天后
- 你可以手动调整结束日期
- 系统会自动计算基期为对比期所在月份的上一个完整月份

### 3. 选择同比年限（可选）
选择要对比的历年数据：
- **仅对比基期**：只看当年 vs 基期
- **对比去年同期**：查看当年和去年同期的对比
- **对比前3年同期**：默认选项，对比近3年同期
- **对比前5年同期**：最多支持5年历史对比

### 4. 高级设置（可选）⚙️
选择年限后，会显示"高级设置"区域：
- **点击展开**：显示每年的日期配置
- **手动调整**：可以为每年单独设置对比期和基期
- **灵活控制**：例如2023年疫情期间可以调整为特殊时段

### 5. 点击"计算增长率"
系统会自动：
1. **查询多年数据**：获取选定年份的同期数据
2. **计算增长率**：每条线路每天相对各自基期的增长率
3. **展示结果**：多年对比图表和详细表格

## 📊 结果说明

### 时间序列图表
- **X轴**：日期（对比期的每一天）
- **Y轴**：增长率（%）
- **折线**：每条线路一条折线，显示每天的增长率变化

### 线路详情卡片
每条线路显示一张卡片，包含：

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1号线                    平均 ↑ +15.23%
基期日均：100,000

日期        当日客流    增长量      增长率
20250501    120,000    +20,000    ↑ +20.00%
20250502    110,000    +10,000    ↑ +10.00%
20250503     95,000     -5,000    ↓  -5.00%
20250504    125,000    +25,000    ↑ +25.00%
20250505    126,200    +26,200    ↑ +26.20%
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**字段说明**：
- **基期日均**：前30天的平均客流量（作为基准）
- **当日客流**：对比期某天的实际客流量
- **增长量**：当日客流 - 基期日均
- **增长率**：增长量 / 基期日均 × 100%
- **平均增长率**：对比期所有天的增长率平均值

### 颜色标识
- 🟢 **绿色/↑**：增长（正值）
- 🔴 **红色/↓**：下降（负值）

## 💡 使用示例

### 示例1：分析五一假期客流（基础模式）
**目标**：查看2025年五一假期相比4月的客流变化

1. 选择指标：**客流量**
2. 选择日期：**2025-05-01** 至 **2025-05-05**
3. 同比年限：**仅对比基期**
4. 点击"计算增长率"

**系统自动计算**：
- 基期：2025-04-01 至 2025-04-30（4月整月）
- 对比期：2025-05-01 至 2025-05-05（五一假期）

**结果**：
- 1号线五一期间平均增长 +25.8%
- 2号线五一期间平均增长 +18.3%
- ...

### 示例2：多年同期对比（自动模式）
**目标**：对比近3年五一假期的客流趋势

1. 选择指标：**客流量**
2. 选择日期：**2025-05-01** 至 **2025-05-05**
3. 同比年限：**对比前3年同期**
4. 点击"计算增长率"

**系统自动查询**：
- 2025年：5月1-5日 vs 4月整月
- 2024年：5月1-5日 vs 4月整月
- 2023年：5月1-5日 vs 4月整月
- 2022年：5月1-5日 vs 4月整月

**结果分析**：
- 图表显示4条折线（每年一条）
- 可以看到逐年增长趋势
- 例如：2025年+25.8%、2024年+22.1%、2023年+18.5%、2022年+15.2%

### 示例3：自定义多年配置（高级模式）
**目标**：对比疫情前后的五一假期，但2020年使用特殊基期

1. 选择指标：**客流量**
2. 选择日期：**2025-05-01** 至 **2025-05-05**
3. 同比年限：**对比前5年同期**
4. **点击"高级设置"展开**
5. 修改2020年配置：
   - 对比期：2020-05-01 至 2020-05-05
   - 基期：2020-01-01 至 2020-01-31（疫情前的1月作为基准）
6. 点击"计算增长率"

**灵活配置**：
- 2025-2021年：使用默认配置（4月整月作为基期）
- 2020年：使用1月作为基期（避免疫情影响）

**结果**：
- 可以更准确地分析疫情对客流的影响
- 看到2020-2021年的恢复趋势


## 🔧 技术细节

### 基期计算规则（自动模式）
- **基期月份** = 对比期开始日期所在月份的上一个月
- **基期开始日期** = 基期月份的1日
- **基期结束日期** = 基期月份的最后一天（自动适配28/29/30/31天）
- **基期日均值** = 基期整月的平均客流量

**示例**：
- 对比期：2025-05-01（5月） → 基期：2025-04-01 至 2025-04-30（4月整月）
- 对比期：2025-02-10（2月） → 基期：2025-01-01 至 2025-01-31（1月整月）
- 对比期：2025-01-15（1月） → 基期：2024-12-01 至 2024-12-31（跨年到12月）

### 增长率计算公式
```
增长率 = (当日客流 - 基期日均) / 基期日均 × 100%
```

### 数据来源
- **LineDailyFlowHistory**：线路日客流历史数据
- **LSTM_COMMON_HOLIDAYFEATURE**：节假日特征
- **CalendarHistory**：日历信息
- **WeatherHistory**：天气数据

## 📥 数据导出

（功能待开发）

## ❓ 常见问题

### Q: 为什么选择前30天作为基期？
A: 30天的样本量足够大，能较好地代表平时的客流水平，同时避免季节性因素影响过大。

### Q: 如果对比期超过30天怎么办？
A: 系统仍然使用对比期开始前的30天作为基期。

### Q: 增长率为0是什么意思？
A: 表示当天客流与基期日均持平，或者基期数据为0。

### Q: 看到负增长率正常吗？
A: 正常。负增长率表示当天客流低于基期日均，可能是工作日、天气等因素影响。

## 🌐 访问地址

- 本机：http://localhost:5000
- 局域网：http://服务器IP:5000

## 📞 技术支持

如有问题，请查看：
- 浏览器控制台（F12）的错误信息
- 服务器终端的日志输出
- DEBUG_GUIDE.md 调试指南

