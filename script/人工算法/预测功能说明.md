# 🔮 客流预测功能使用说明

## 功能概述

基于历年同期的最优增长率进行客流预测，并自动对比实际值验证准确率。

## 📋 预测原理

### 预测公式
```
预测客流 = 基期日均 × (1 + 历年最优增长率 / 100)
```

### 计算步骤

#### 第1步：计算基期日均
- **基期**：预测月份的上一个完整月份
- **计算**：该月所有天的平均客流量

**示例**：
- 预测：2025年4月30日-5月5日
- 基期：2025年3月1日-3月31日
- 基期日均 = 3月所有天的平均客流

#### 第2步：查询历年同期数据
根据选择的历史年限（如前2年），查询：
- 2024年4月30日-5月5日
- 2023年4月30日-5月5日

并计算每年各自的基期日均和增长率。

#### 第3步：提取最优增长率
按"第几天"分组，取历年最大值：
- 第1天：max(2024年第1天, 2023年第1天)
- 第2天：max(2024年第2天, 2023年第2天)
- ...

#### 第4步：计算预测值
```
第1天预测 = 2025年3月日均 × (1 + 第1天最优增长率)
第2天预测 = 2025年3月日均 × (1 + 第2天最优增长率)
...
```

#### 第5步：验证准确率（如果有实际数据）
```
准确率 = (1 - |预测值 - 实际值| / 实际值) × 100%
```

## 🎯 使用步骤

### 1. 切换到预测标签页
点击页面顶部的"🔮 客流预测"标签

### 2. 选择指标类型
- 客流量
- 进站人数
- 出站人数
- 换乘人数
- 乘降量

### 3. 选择预测日期
例如：2025-04-30 至 2025-05-05

系统自动显示基期：2025-03-01 至 2025-03-31

### 4. 选择参考历史年限
- 参考前1年
- 参考前2年（默认）
- 参考前3年
- ...

### 5. 点击"开始预测"
系统开始计算并显示结果

## 📊 预测结果展示

### 无实际数据情况（纯预测）

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🌐 线网（线网总体）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

日期      基期日均   最优增长率  来源年份  预测客流
20250430  850,000    ↑ 25.50%   2024年   1,066,750
20250501  850,000    ↑ 28.30%   2023年   1,090,550
20250502  850,000    ↑ 32.10%   2024年   1,122,850
...
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 有实际数据情况（预测+验证）

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🎯 预测准确率统计

总体平均准确率         1号线              2号线
   92.50%            94.20%            90.80%
  40条数据           8条数据            8条数据
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🌐 线网（线网总体）              准确率: 93.50%
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

日期      基期日均   最优增长率  来源  预测客流   实际客流   误差      准确率
20250430  850,000   ↑ 25.50%   2024  1,066,750  1,080,000  -13,250   98.77%
20250501  850,000   ↑ 28.30%   2023  1,090,550  1,105,230  -14,680   98.67%
20250502  850,000   ↑ 32.10%   2024  1,122,850  1,098,450  +24,400   97.78%
...
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## 📈 字段说明

| 字段 | 说明 | 示例 |
|------|------|------|
| 日期 | 预测的日期 | 20250430 |
| 基期日均 | 预测基期的日均客流 | 850,000 |
| 最优增长率 | 历年同期的最大增长率 | ↑ 28.30% |
| 来源年份 | 最优增长率来自哪一年 | 2023年 |
| 预测客流 | 计算出的预测值 | 1,090,550 |
| 实际客流 | 数据库中的实际值 | 1,105,230 |
| 误差 | 预测值 - 实际值 | -14,680 |
| 准确率 | 预测准确度（%） | 98.67% |

## 🎯 准确率评级

| 准确率 | 评级 | 颜色 | 说明 |
|-------|------|------|------|
| ≥ 90% | 优秀 | 🟢 绿色 | 预测非常准确 |
| 80-90% | 良好 | 🟡 橙色 | 预测较为准确 |
| < 80% | 待改进 | 🔴 红色 | 预测偏差较大 |

## 💡 使用场景

### 场景1：五一假期客流预测
**需求**：提前预测2025年五一假期客流，安排运力

1. 选择预测日期：2025-04-30 至 2025-05-05
2. 参考历史：前2年
3. 开始预测

**结果**：
- 基于2024年和2023年五一的最优表现
- 结合2025年3月的实际客流水平
- 得到2025年五一的预测客流
- 如果五一已过，还能看到预测准确率

### 场景2：验证预测模型
**需求**：验证预测方法的准确性

1. 选择已过去的日期（如2024年5月1-5日）
2. 参考历史：前2年（2023、2022）
3. 开始预测

**结果**：
- 系统预测2024年五一客流
- 对比数据库中的实际值
- 显示准确率（如92.5%）
- 验证模型可靠性

### 场景3：多次迭代优化
**需求**：调整参考年限，找到最优预测方案

1. 第1次：参考前1年 → 准确率85%
2. 第2次：参考前2年 → 准确率92%
3. 第3次：参考前3年 → 准确率89%

**结论**：参考前2年效果最好

## 🔍 预测结果分析

### 正误差（+）
预测值 > 实际值：预测偏高
- 可能原因：天气、特殊事件、运营调整
- 应对：适当减少运力配置

### 负误差（-）
预测值 < 实际值：预测偏低
- 可能原因：假期效应增强、营销活动
- 应对：增加备用运力

### 高准确率
准确率 > 90%：模型可靠
- 说明：历年规律稳定
- 应用：可直接用于规划

### 低准确率
准确率 < 80%：需要调整
- 原因：可能需要更多年份数据
- 建议：增加参考年限或考虑其他因素

## 📥 导出功能

（待开发）可导出预测结果CSV，包含预测值和准确率对比。

## ⚠️ 注意事项

### 1. 数据要求
- 需要有完整的基期数据（预测月份的上月）
- 需要有历年同期数据
- 数据越完整，预测越准确

### 2. 适用场景
- ✅ 规律性强的节假日（春节、五一、国庆）
- ✅ 周末客流预测
- ⚠️ 特殊事件期间（疫情、大型活动）需谨慎

### 3. 局限性
- 仅考虑历史增长率，未考虑：
  - 天气变化
  - 政策调整
  - 突发事件
  - 长期趋势变化

### 4. 建议
- 结合实际情况调整预测结果
- 定期验证预测准确率
- 持续优化参考年限选择

## 🔧 技术细节

### 预测基期
- 自动计算为预测月份的上一个完整月份
- 例如：预测5月 → 基期4月整月

### 历年同期
- 自动对齐到相同的日期
- 例如：预测5月1-5日 → 查询2024/2023年的5月1-5日

### 最优增长率
- 按"第几天"分组
- 取所有年份中的最大增长率
- 用于保守预测的上限

## 💼 实际应用价值

1. **运力规划**：提前安排车辆和人员
2. **资源调度**：优化配置，降低成本
3. **风险管理**：识别高峰期，提前预警
4. **决策支持**：为管理层提供数据依据
5. **模型验证**：持续改进预测方法

