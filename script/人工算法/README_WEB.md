# 客流历史数据查询 Web 系统

这是一个基于 Flask 的 Web 应用，用于查询和导出线路客流历史数据。

## 功能特点

- 🔍 **日期范围查询**: 通过可视化界面选择开始和结束日期
- 📊 **多指标支持**: 支持客流量、进站、出站、换乘、乘降量等多种指标
- 📥 **数据导出**: 支持将查询结果导出为 CSV 文件
- 🎨 **现代化界面**: 响应式设计，美观易用
- ⚡ **实时查询**: 快速查询数据库并展示结果
- 🌏 **完美中文支持**: 所有数据和列名均正确显示中文
- 📋 **精简显示**: 只显示关键字段，界面清爽整洁
- 🔢 **数字格式化**: 自动添加千位分隔符，便于阅读

## 安装步骤

### 1. 安装依赖

```bash
pip install -r requirements_web.txt
```

### 2. 配置数据库

确保 `yunying.py` 中的数据库配置正确：

```python
DB_CONFIG = {
    "server": "10.1.6.230",
    "user": "sa",
    "password": "YourStrong!Passw0rd",
    "database": "master",
    "port": 1433
}
```

## 使用方法

### 启动 Web 服务器

```bash
python web_app.py
```

服务器将在 `http://0.0.0.0:5000` 上运行。

### 访问 Web 界面

在浏览器中打开：
```
http://localhost:5000
```
或者在同一网络内的其他设备上访问：
```
http://<服务器IP>:5000
```

### 查询数据

1. 选择指标类型（客流量、进站人数、出站人数、换乘人数、上下车人数）
2. 选择开始日期和结束日期
3. 点击"查询数据"按钮
4. 查看查询结果表格

### 导出数据

查询成功后，点击"导出CSV"按钮即可下载 CSV 文件。

## 支持的指标类型

- **客流量**: 线路总客流量
- **进站人数**: 进站乘客数量
- **出站人数**: 出站乘客数量
- **换乘人数**: 换乘乘客数量
- **乘降量**: 上下车乘客总量

## 显示字段说明

查询结果默认显示以下字段：

| 字段名 | 说明 |
|--------|------|
| 日期 | 数据日期 (F_DATE) |
| 线路编号 | 线路的编号 (F_LINENO) |
| 线路名称 | 线路的名称 (F_LINENAME) |
| 客流量/进站人数/出站人数/换乘人数/乘降量 | 根据选择的指标类型显示对应数值 |
| 天气类型 | 当天的天气情况 (WEATHER_TYPE) |
| 日期特征 | 节假日、工作日等特征 (F_DATEFEATURES) |

其他字段已被隐藏以保持界面简洁，如需完整数据请导出CSV文件。

## 技术栈

- **后端**: Flask (Python)
- **前端**: HTML5, CSS3, JavaScript (原生)
- **数据库**: SQL Server (pymssql)
- **数据处理**: Pandas

## 注意事项

- 确保数据库服务器可访问
- 日期格式会自动转换为 `yyyymmdd` 格式
- 查询大量数据时可能需要较长时间，请耐心等待
- 导出的 CSV 文件使用 UTF-8 BOM 编码，兼容 Excel

## 故障排除

### 无法连接数据库
- 检查数据库服务器地址和端口
- 确认用户名和密码正确
- 检查网络连接和防火墙设置

### 页面无法加载
- 确认 Flask 服务器正在运行
- 检查端口 5000 是否被占用
- 查看终端错误信息

## 目录结构

```
人工算法/
├── web_app.py              # Flask 应用主文件
├── yunying.py              # 数据库查询模块
├── requirements_web.txt    # Python 依赖
├── README_WEB.md           # 本说明文档
└── templates/
    └── index.html          # Web 界面模板
```

